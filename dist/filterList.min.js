"use strict";var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}();function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var FilterList=function(){function t(e){_classCallCheck(this,t),this.urlIsUpdatable=void 0!==e.urlIsUpdatable&&e.urlIsUpdatable,this.element=e.element,this.filters=[],this.filterNames=this.element.getAttribute("data-filter-names").split(" "),this.initCallback=e.initCallback,this.filtersCallback=e.filtersCallback,this.url=window.location.href,this.lastClass=e.lastClass,this.setEventHandlers(),this.setDefaultFilters(this.filterNames),this.updateFiltersfromURL(),this.updateBrowserHistory(),"function"==typeof this.initCallback&&this.initCallback(),this.applyFilters()}return _createClass(t,[{key:"updateBrowserHistory",value:function(){if(this.urlIsUpdatable&&window.history&&window.history.pushState){var t={};t.filters=this.filters.slice(),history.replaceState(t,document.title,this.url)}}},{key:"setDefaultFilters",value:function(t){var e=this;t.forEach(function(t,a){var i=e.element.getAttribute("data-filter-"+t+"-ignore"),r=e.getFilterValue(t);e.filters.push({name:t,value:r,ignoreValue:i})})}},{key:"getFilterValue",value:function(t){var e=document.querySelector('[name="'+t+'"]'),a=void 0;return e?a="checkbox"===e.getAttribute("type")?e.checked?e.value:void 0:e.value:console.warn("No filter with name "+t+" was found in markup!"),a}},{key:"updateFiltersfromURL",value:function(){var t=this;this.filterNames.forEach(function(e,a){var i=t.getUrlParameter(e);i&&t.updateFilters({name:e,value:i},!0)})}},{key:"updateFilters",value:function(t,e){var a=this.filters.find(function(e){return e.name===t.name});a&&a.value!==t.value&&(a.value=t.value,this.applyFilters(),e&&this.updateDOM([a]))}},{key:"setEventHandlers",value:function(){var t=this;this.filterNames.forEach(function(e,a){var i=document.querySelector('[name="'+e+'"]');i&&i.addEventListener("change",function(a){t.updateFilters({name:e,value:t.getFilterValue(e)}),t.urlIsUpdatable&&t.updateURL()})}),this.urlIsUpdatable&&window.history&&window.history.pushState&&window.addEventListener("popstate",function(e){if(e.state.filters){for(var a in e.state.filters)t.filters[a]=e.state.filters[a];t.updateDOM(e.state.filters),t.applyFilters()}})}},{key:"updateDOM",value:function(t){for(var e in t){var a=t[e],i=document.querySelector('[name="'+a.name+'"]');i&&("SELECT"===i.tagName&&(i.value=a.value),"INPUT"===i.tagName&&"checkbox"===i.getAttribute("type")&&(i.checked=i.value===a.value))}}},{key:"setFilters",value:function(t){var e=this,a=function(a){e.filters.forEach(function(e,i){e.name===a&&(e.value=t[a])})};for(var i in t)a(i);this.updateDOM(this.filters),this.applyFilters(),this.urlIsUpdatable&&this.updateURL()}},{key:"applyFilters",value:function(){var t=this,e=[],a=this.element.children;if(this.lastClass){var i=this.element.querySelector("."+this.lastClass);i&&i.classList.remove(this.lastClass)}[].concat(_toConsumableArray(a)).forEach(function(a){var i=a,r=!0;t.filters.forEach(function(t,e){if(void 0!==t.value&&t.value!==t.ignoreValue&&(!i.hasAttribute("data-filter-"+t.name)||i.getAttribute("data-filter-"+t.name)!==t.value))return r=!1,!1}),r&&e.push(i)}),[].concat(_toConsumableArray(a)).forEach(function(t){t.style.display="none"}),0!==e.length?(e.forEach(function(a,i){a.style.display="block",t.lastClass&&i===e.length-1&&a.classList.add(t.lastClass)}),this.element.classList.remove("is-empty")):this.element.classList.add("is-empty"),"function"==typeof this.filtersCallback&&this.filtersCallback()}},{key:"updateURL",value:function(){var t=this;if(window.history&&window.history.pushState){var e={};e.filters=Object.assign({},this.filters),this.filters.forEach(function(e){void 0!==e.value&&(t.url=t.updateQueryStringParameter(t.url,e.name,e.value))}),history.pushState(e,document.title,this.url)}}},{key:"getUrlParameter",value:function(t){var e,a,i=decodeURIComponent(window.location.search.substring(1)).split("&");for(a=0;a<i.length;a++)if((e=i[a].split("="))[0]===t)return void 0===e[1]||e[1]}},{key:"updateQueryStringParameter",value:function(t,e,a){var i=new RegExp("([?&])"+e+"=.*?(&|$)","i"),r=-1!==t.indexOf("?")?"&":"?";return t.match(i)?t.replace(i,"$1"+e+"="+a+"$2"):t+r+e+"="+a}}]),t}();