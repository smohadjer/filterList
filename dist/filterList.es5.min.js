"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}var FilterList=function(){function t(e){_classCallCheck(this,t),this.urlIsUpdatable=void 0!==e.urlIsUpdatable&&e.urlIsUpdatable,this.element=e.element,this.filters=[],this.filterNames=this.element.getAttribute("data-filter-names").split(" "),this.initCallback=e.initCallback,this.filtersCallback=e.filtersCallback,this.url=window.location.href,this.lastClass=e.lastClass||"last",this.hiddenClass=e.hiddenClass||"hidden",this.setEventHandlers(),this.setDefaultFilters(this.filterNames),this.updateFiltersfromURL(),this.updateBrowserHistory(),"function"==typeof this.initCallback&&this.initCallback(),this.applyFilters()}return _createClass(t,[{key:"updateBrowserHistory",value:function(){if(this.urlIsUpdatable&&window.history&&window.history.pushState){var e={};e.filters=this.filters.slice(),history.replaceState(e,document.title,this.url)}}},{key:"setDefaultFilters",value:function(e){var i=this;e.forEach(function(e){var t=i.getFilterIgnoreValue(e),a=i.getFilterValue(e);i.filters.push({name:e,value:a,ignoreValue:t})})}},{key:"getFilterIgnoreValue",value:function(e){var t=document.querySelector('[name="'+e+'"]'),a=void 0;return t?"SELECT"===t.tagName&&(a=t.getAttribute("data-ignore")):console.warn("No filter with name "+e+" was found in markup!"),a}},{key:"getFilterValue",value:function(e){var t=document.querySelector('[name="'+e+'"]'),a=void 0;return t?a="checkbox"===t.getAttribute("type")?t.checked?t.value:void 0:t.value:console.warn("No filter with name "+e+" was found in markup!"),a}},{key:"updateFiltersfromURL",value:function(){var a=this;this.filterNames.forEach(function(e){var t=function(e){var t,a,i=decodeURIComponent(window.location.search.substring(1)).split("&");for(a=0;a<i.length;a++)if((t=i[a].split("="))[0]===e)return void 0===t[1]||t[1]}(e);t&&a.updateFilters({name:e,value:t},!0)})}},{key:"updateFilters",value:function(t,e){var a=this.filters.find(function(e){return e.name===t.name});a&&a.value!==t.value&&(a.value=t.value,this.applyFilters(),e&&this.updateDOM([a]))}},{key:"setEventHandlers",value:function(){var a=this;this.filterNames.forEach(function(e){var t=document.querySelector('[name="'+e+'"]');t&&t.addEventListener("change",function(){a.updateFilters({name:e,value:a.getFilterValue(e)}),a.urlIsUpdatable&&a.updateURL()})}),this.urlIsUpdatable&&window.history&&window.history.pushState&&window.addEventListener("popstate",function(e){if(e.state.filters){for(var t in e.state.filters)a.filters[t]=e.state.filters[t];a.updateDOM(e.state.filters),a.applyFilters()}})}},{key:"updateDOM",value:function(e){for(var t in e){var a=e[t],i=document.querySelector('[name="'+a.name+'"]');i&&("SELECT"===i.tagName&&(i.value=a.value),"INPUT"===i.tagName&&"checkbox"===i.getAttribute("type")&&(i.checked=i.value===a.value))}}},{key:"setFilters",value:function(a){function e(t){this.filters.forEach(function(e){e.name===t&&(e.value=a[t])})}for(var t in a)e(t);this.updateDOM(this.filters),this.applyFilters(),this.urlIsUpdatable&&this.updateURL()}},{key:"applyFilters",value:function(){var i=this,r=[],e=this.element.children;if(this.lastClass){var t=this.element.querySelector("."+this.lastClass);t&&t.classList.remove(this.lastClass)}[].concat(_toConsumableArray(e)).forEach(function(t){var a=!0;i.filters.forEach(function(e){if(void 0!==e.value&&e.value!==e.ignoreValue&&(!t.hasAttribute("data-filter-"+e.name)||t.getAttribute("data-filter-"+e.name)!==e.value))return a=!1}),a&&r.push(t)}),[].concat(_toConsumableArray(e)).forEach(function(e){e.classList.add(i.hiddenClass)}),0!==r.length?(r.forEach(function(e,t){e.classList.remove(i.hiddenClass),i.lastClass&&t===r.length-1&&e.classList.add(i.lastClass)}),this.element.classList.remove("is-empty")):this.element.classList.add("is-empty"),"function"==typeof this.filtersCallback&&this.filtersCallback()}},{key:"updateURL",value:function(){var t=this;if(window.history&&window.history.pushState){var e={};e.filters=Object.assign({},this.filters),this.filters.forEach(function(e){void 0!==e.value&&0!==e.value.length&&e.value!==e.ignoreValue?t.url=function(e,t,a){var i=new RegExp("([?&])"+t+"=.*?(&|$)","i"),r=-1!==e.indexOf("?")?"&":"?";return e.match(i)?e.replace(i,"$1"+t+"="+a+"$2"):e+r+t+"="+a}(t.url,e.name,e.value):t.url=function(e,t){var a=e.split("?");if(2<=a.length){for(var i=encodeURIComponent(t)+"=",r=a[1].split(/[&;]/g),l=r.length;0<l--;)-1!==r[l].lastIndexOf(i,0)&&r.splice(l,1);return e=a[0]+(0<r.length?"?"+r.join("&"):"")}return e}(t.url,e.name)}),history.pushState(e,document.title,this.url)}}}]),t}();