"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}var FilterList=function(){function t(e){_classCallCheck(this,t),this.urlIsUpdatable=void 0!==e.urlIsUpdatable&&e.urlIsUpdatable,this.element=e.element,this.filters=[],this.filterNames=this.element.getAttribute("data-filter-names").split(" "),this.initCallback=e.initCallback,this.filtersCallback=e.filtersCallback,this.url=window.location.href,this.lastClass=e.lastClass||"last",this.hiddenClass=e.hiddenClass||"hidden",this.excludeClass=e.excludeFromFilteringClass||"filterList__exclude",this.filterSelector=e.filterSelector,this.setEventHandlers(),this.setDefaultFilters(this.filterNames),this.updateFiltersfromURL(),this.updateBrowserHistory(),"function"==typeof this.initCallback&&this.initCallback(),this.applyFilters()}return _createClass(t,[{key:"updateBrowserHistory",value:function(){if(this.urlIsUpdatable&&window.history&&window.history.pushState){var e={};e.filters=this.filters.slice(),history.replaceState(e,document.title,this.url)}}},{key:"setDefaultFilters",value:function(e){var i=this;e.forEach(function(e){var t=i.getFilterIgnoreValue(e),a=i.getFilterValue(e);i.filters.push({name:e,value:a,ignoreValue:t})})}},{key:"getFilterIgnoreValue",value:function(e){var t,a=document.querySelector('[name="'.concat(e,'"]'));return a?"SELECT"===a.tagName&&(t=a.getAttribute("data-ignore")):console.warn("No filter with name "+e+" was found in markup!"),t}},{key:"getFilterValue",value:function(e){var t,a=document.querySelector('[name="'.concat(e,'"]'));return a?t="checkbox"===a.getAttribute("type")?a.checked?a.value:void 0:a.value:console.warn("No filter with name "+e+" was found in markup!"),t}},{key:"updateFiltersfromURL",value:function(){var a=this;this.filterNames.forEach(function(e){var t=function(e){var t,a,i=decodeURIComponent(window.location.search.substring(1)).split("&");for(a=0;a<i.length;a++)if((t=i[a].split("="))[0]===e)return void 0===t[1]||t[1]}(e);t&&a.updateFilters({name:e,value:t},!0)})}},{key:"updateFilters",value:function(t,e){var a=this.filters.find(function(e){return e.name===t.name});a&&a.value!==t.value&&(a.value=t.value,this.applyFilters(),e&&this.updateDOM([a]))}},{key:"setEventHandlers",value:function(){var a=this;this.filterNames.forEach(function(e){var t=document.querySelector('[name="'+e+'"]');t&&t.addEventListener("change",function(){a.updateFilters({name:e,value:a.getFilterValue(e)}),a.urlIsUpdatable&&a.updateURL()})}),this.urlIsUpdatable&&window.history&&window.history.pushState&&window.addEventListener("popstate",function(e){if(e.state.filters){for(var t in e.state.filters)a.filters[t]=e.state.filters[t];a.updateDOM(e.state.filters),a.applyFilters()}})}},{key:"updateDOM",value:function(e){for(var t in e){var a=e[t],i=document.querySelector('[name="'.concat(a.name,'"]'));i&&("SELECT"===i.tagName&&(i.value=a.value),"INPUT"===i.tagName&&"checkbox"===i.getAttribute("type")&&(i.checked=i.value===a.value))}}},{key:"setFilters",value:function(a){function e(t){i.filters.forEach(function(e){e.name===t&&(e.value=a[t])})}var i=this;for(var t in a)e(t);this.updateDOM(this.filters),this.applyFilters(),this.urlIsUpdatable&&this.updateURL()}},{key:"applyFilters",value:function(){var e,i=this,l=[],t=[];e=this.filterSelector?this.element.querySelectorAll(this.filterSelector):this.element.children;var a=!0,s=!1,r=void 0;try{for(var n,u=e[Symbol.iterator]();!(a=(n=u.next()).done);a=!0){var o=n.value;o.classList.contains(this.excludeClass)||t.push(o)}}catch(e){s=!0,r=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw r}}if(this.lastClass){var c=this.element.querySelector(".".concat(this.lastClass));c&&c.classList.remove(this.lastClass)}[].concat(t).forEach(function(t){var a=!0;i.filters.forEach(function(e){if(void 0!==e.value&&e.value!==e.ignoreValue&&(!t.hasAttribute("data-filter-"+e.name)||t.getAttribute("data-filter-"+e.name)!==e.value))return a=!1}),a&&l.push(t)}),[].concat(t).forEach(function(e){e.classList.add(i.hiddenClass)}),0!==l.length?(l.forEach(function(e,t){e.classList.remove(i.hiddenClass),i.lastClass&&t===l.length-1&&e.classList.add(i.lastClass)}),this.element.classList.remove("is-empty")):this.element.classList.add("is-empty"),"function"==typeof this.filtersCallback&&this.filtersCallback()}},{key:"updateURL",value:function(){var t=this;if(window.history&&window.history.pushState){var e={};e.filters=Object.assign({},this.filters),this.filters.forEach(function(e){void 0!==e.value&&0!==e.value.length&&e.value!==e.ignoreValue?t.url=function(e,t,a){var i=new RegExp("([?&])"+t+"=.*?(&|$)","i"),l=-1!==e.indexOf("?")?"&":"?";return e.match(i)?e.replace(i,"$1"+t+"="+a+"$2"):e+l+t+"="+a}(t.url,e.name,e.value):t.url=function(e,t){var a=e.split("?");if(2<=a.length){for(var i=encodeURIComponent(t)+"=",l=a[1].split(/[&;]/g),s=l.length;0<s--;)-1!==l[s].lastIndexOf(i,0)&&l.splice(s,1);return e=a[0]+(0<l.length?"?"+l.join("&"):"")}return e}(t.url,e.name)}),history.pushState(e,document.title,this.url)}}}]),t}();