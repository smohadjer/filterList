"use strict";var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var FilterList=function(){return function(){function e(t){_classCallCheck(this,e),this.urlIsUpdatable=void 0!==t.urlIsUpdatable&&t.urlIsUpdatable,this.element=t.element,this.filters=[],this.filterNames=this.element.getAttribute("data-filter-names").split(" "),this.initCallback=t.initCallback,this.filtersCallback=t.filtersCallback,this.url=window.location.href,this.lastClass=t.lastClass||"last",this.hiddenClass=t.hiddenClass||"hidden",this.setEventHandlers(),this.setDefaultFilters(this.filterNames),this.updateFiltersfromURL(),this.updateBrowserHistory(),"function"==typeof this.initCallback&&this.initCallback(),this.applyFilters()}return _createClass(e,[{key:"updateBrowserHistory",value:function(){if(this.urlIsUpdatable&&window.history&&window.history.pushState){var e={};e.filters=this.filters.slice(),history.replaceState(e,document.title,this.url)}}},{key:"setDefaultFilters",value:function(e){var t=this;e.forEach(function(e,a){var i=t.getFilterIgnoreValue(e),l=t.getFilterValue(e);t.filters.push({name:e,value:l,ignoreValue:i})})}},{key:"getFilterIgnoreValue",value:function(e){var t=document.querySelector('[name="'+e+'"]'),a=void 0;return t?"SELECT"===t.tagName&&(a=t.getAttribute("data-ignore")):console.warn("No filter with name "+e+" was found in markup!"),a}},{key:"getFilterValue",value:function(e){var t=document.querySelector('[name="'+e+'"]'),a=void 0;return t?a="checkbox"===t.getAttribute("type")?t.checked?t.value:void 0:t.value:console.warn("No filter with name "+e+" was found in markup!"),a}},{key:"updateFiltersfromURL",value:function(){var e=this;this.filterNames.forEach(function(t,a){var i=function(e){var t,a,i=decodeURIComponent(window.location.search.substring(1)).split("&");for(a=0;a<i.length;a++)if((t=i[a].split("="))[0]===e)return void 0===t[1]||t[1]}(t);i&&e.updateFilters({name:t,value:i},!0)})}},{key:"updateFilters",value:function(e,t){var a=this.filters.find(function(t){return t.name===e.name});a&&a.value!==e.value&&(a.value=e.value,this.applyFilters(),t&&this.updateDOM([a]))}},{key:"setEventHandlers",value:function(){var e=this;this.filterNames.forEach(function(t,a){var i=document.querySelector('[name="'+t+'"]');i&&i.addEventListener("change",function(a){e.updateFilters({name:t,value:e.getFilterValue(t)}),e.urlIsUpdatable&&e.updateURL()})}),this.urlIsUpdatable&&window.history&&window.history.pushState&&window.addEventListener("popstate",function(t){if(t.state.filters){for(var a in t.state.filters)e.filters[a]=t.state.filters[a];e.updateDOM(t.state.filters),e.applyFilters()}})}},{key:"updateDOM",value:function(e){for(var t in e){var a=e[t],i=document.querySelector('[name="'+a.name+'"]');i&&("SELECT"===i.tagName&&(i.value=a.value),"INPUT"===i.tagName&&"checkbox"===i.getAttribute("type")&&(i.checked=i.value===a.value))}}},{key:"setFilters",value:function(e){var t=this,a=function(a){t.filters.forEach(function(t,i){t.name===a&&(t.value=e[a])})};for(var i in e)a(i);this.updateDOM(this.filters),this.applyFilters(),this.urlIsUpdatable&&this.updateURL()}},{key:"applyFilters",value:function(){var e=this,t=[],a=this.element.children;if(this.lastClass){var i=this.element.querySelector("."+this.lastClass);i&&i.classList.remove(this.lastClass)}[].concat(_toConsumableArray(a)).forEach(function(a){var i=!0;e.filters.forEach(function(e,t){if(void 0!==e.value&&e.value!==e.ignoreValue&&(!a.hasAttribute("data-filter-"+e.name)||a.getAttribute("data-filter-"+e.name)!==e.value))return i=!1,!1}),i&&t.push(a)}),[].concat(_toConsumableArray(a)).forEach(function(t){t.classList.add(e.hiddenClass)}),0!==t.length?(t.forEach(function(a,i){a.classList.remove(e.hiddenClass),e.lastClass&&i===t.length-1&&a.classList.add(e.lastClass)}),this.element.classList.remove("is-empty")):this.element.classList.add("is-empty"),"function"==typeof this.filtersCallback&&this.filtersCallback()}},{key:"updateURL",value:function(){var e=this;if(window.history&&window.history.pushState){var t={};t.filters=Object.assign({},this.filters),this.filters.forEach(function(t){var a,i,l,r,s;void 0!==t.value&&0!==t.value.length&&t.value!==t.ignoreValue?e.url=(a=e.url,i=t.name,l=t.value,r=new RegExp("([?&])"+i+"=.*?(&|$)","i"),s=-1!==a.indexOf("?")?"&":"?",a.match(r)?a.replace(r,"$1"+i+"="+l+"$2"):a+s+i+"="+l):e.url=function(e,t){var a=e.split("?");if(a.length>=2){for(var i=encodeURIComponent(t)+"=",l=a[1].split(/[&;]/g),r=l.length;r-- >0;)-1!==l[r].lastIndexOf(i,0)&&l.splice(r,1);return e=a[0]+(l.length>0?"?"+l.join("&"):"")}return e}(e.url,t.name)}),history.pushState(t,document.title,this.url)}}}]),e}()}();